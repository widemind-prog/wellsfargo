{% extends "app_base.html" %}
{% block title %}Accounts{% endblock %}

{% block content %}

<!-- GREETING HEADER -->
<div style="margin-bottom:24px;">
    <h1 id="greetingText" style="color: #b31b1b; margin-bottom:4px;"></h1>
    <p style="color: #888; margin-top:0;">Customer since 20**</p>
</div>

<!-- SECTION HEADER -->
<div class="accounts-header" style="
    display:flex; 
    align-items:center; 
    justify-content:space-between; 
    margin-bottom:18px;
">
    <h2 style="margin:0;">Accounts</h2>
    <button id="toggleBalancesBtn" onclick="toggleAllBalances()" 
        style="background:none; border:none; cursor:pointer; padding:12px; display:flex; align-items:center; justify-content:center;">
    <i id="toggleEyeIcon" class="fa-solid fa-eye" style="font-size:1rem;"></i>
</button>
</div>

<!-- ACCOUNTS SECTION LIST -->
<div class="accounts-section">

    {% for account in accounts %}
    <a href="{{ url_for('account_details', account_id=account.id) }}" 
       class="account-row">

        <!-- LEFT SIDE -->
        <div>
            <h3 style="margin:0; font-size:1.05rem;">
                {{ account.type }}
            </h3>
            <small style="color:#666;">
                {{ account.number[:5] }} **** {{ account.number[-4:] }}
            </small>
        </div>

        <!-- RIGHT SIDE -->
        <div style="text-align:right;">
            <p class="balance-amount" 
               style="margin:0; font-size:1.3rem; font-weight:600;">
                ${{ "%.2f"|format(account.balance) }}
            </p>
            <small style="color:#888;">Available balance</small>
        </div>

    </a>
    {% endfor %}

</div>


<style>
.accounts-section {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.account-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 14px 0;
    text-decoration: none;
    border-bottom: 1px solid #eee;
    color: #111;
    transition: opacity 0.2s ease;
}

.account-row:hover {
    opacity: 0.7;
}

.account-row h3 {
    font-weight: 600;
}
</style>


<script>
// -------------------------------
// DYNAMIC GREETING
// -------------------------------
function setGreeting() {
    const hour = new Date().getHours();
    let greeting = "Good evening";

    if (hour < 12) {
        greeting = "Good morning";
    } else if (hour < 18) {
        greeting = "Good afternoon";
    }

    const fullName = "{{ session.get('user') }}";
    const firstName = fullName.split(" ")[0];

    document.getElementById("greetingText").innerText =
        greeting + ", " + firstName;
}

setGreeting();


// -------------------------------
// BALANCE TOGGLE
// -------------------------------
const BALANCE_HIDDEN_KEY = 'balancesHidden';

function toggleAllBalances() {
    const hidden = localStorage.getItem(BALANCE_HIDDEN_KEY) === 'true';
    const newState = !hidden;
    localStorage.setItem(BALANCE_HIDDEN_KEY, newState);
    updateAllBalances();
}

function updateAllBalances() {
    const hidden = localStorage.getItem(BALANCE_HIDDEN_KEY) === 'true';
    const balanceElements = document.querySelectorAll('.balance-amount');
    const eyeIcon = document.getElementById('toggleEyeIcon');

    balanceElements.forEach(el => {
        if (!el.getAttribute('data-balance')) {
            el.setAttribute('data-balance', el.textContent);
        }
        el.textContent = hidden ? '****' : el.getAttribute('data-balance');
    });

    eyeIcon.className = hidden ? 
        'fa-solid fa-eye-slash' : 
        'fa-solid fa-eye';
}

document.addEventListener('DOMContentLoaded', updateAllBalances);
</script>

{% endblock %}